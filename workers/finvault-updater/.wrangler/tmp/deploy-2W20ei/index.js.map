{
  "version": 3,
  "sources": ["../../../src/index.ts"],
  "sourceRoot": "C:\\Users\\Admin\\OneDrive\\M\u00E1y t\u00EDnh\\My Vault\\workers\\finvault-updater\\.wrangler\\tmp\\deploy-2W20ei",
  "sourcesContent": ["interface Env {\r\n    DB: D1Database;\r\n}\r\n\r\nexport default {\r\n    async scheduled(event: ScheduledEvent, env: Env, ctx: ExecutionContext) {\r\n        const SYMBOLS = ['TCB', 'HPG', 'MBB', 'DFIX', 'VNDAF'];\r\n        console.log(`[Cron] Starting update for: ${SYMBOLS.join(', ')}`);\r\n\r\n        for (const symbol of SYMBOLS) {\r\n            try {\r\n                // Fetch from TCBS\r\n                const res = await fetch(`https://apipubaws.tcbs.com.vn/tcanalysis/v1/ticker/${symbol}/overview`);\r\n\r\n                if (res.ok) {\r\n                    const data: any = await res.json();\r\n                    // Data shape: { ticker: 'TCB', price: 35900, change: 0.32, ... }\r\n                    // Note: TCBS uses 'price' (or 'close'?) and 'change' (value or percent?)\r\n                    // Usually 'price' is current price. Update logic if valid.\r\n\r\n                    const price = data.price || data.close || 0;\r\n                    const change = data.change || 0;\r\n\r\n                    if (price > 0) {\r\n                        console.log(`Updating ${symbol}: ${price}`);\r\n                        await env.DB.prepare(\r\n                            `INSERT INTO market_signals (symbol, price, change, updated_at) \r\n                  VALUES (?, ?, ?, ?)\r\n                  ON CONFLICT(symbol) DO UPDATE SET\r\n                  price=excluded.price,\r\n                  change=excluded.change,\r\n                  updated_at=excluded.updated_at`\r\n                        ).bind(price, change, Math.floor(Date.now() / 1000), symbol).run();\r\n                    }\r\n                } else {\r\n                    console.error(`Failed to fetch ${symbol}: ${res.status}`);\r\n                }\r\n            } catch (e) {\r\n                console.error(`Error processing ${symbol}`, e);\r\n            }\r\n        }\r\n    }\r\n}\r\n"],
  "mappings": ";AAIA,IAAO,gBAAQ;AAAA,EACX,MAAM,UAAU,OAAuB,KAAU,KAAuB;AACpE,UAAM,UAAU,CAAC,OAAO,OAAO,OAAO,QAAQ,OAAO;AACrD,YAAQ,IAAI,+BAA+B,QAAQ,KAAK,IAAI,CAAC,EAAE;AAE/D,eAAW,UAAU,SAAS;AAC1B,UAAI;AAEA,cAAM,MAAM,MAAM,MAAM,sDAAsD,MAAM,WAAW;AAE/F,YAAI,IAAI,IAAI;AACR,gBAAM,OAAY,MAAM,IAAI,KAAK;AAKjC,gBAAM,QAAQ,KAAK,SAAS,KAAK,SAAS;AAC1C,gBAAM,SAAS,KAAK,UAAU;AAE9B,cAAI,QAAQ,GAAG;AACX,oBAAQ,IAAI,YAAY,MAAM,KAAK,KAAK,EAAE;AAC1C,kBAAM,IAAI,GAAG;AAAA,cACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAMJ,EAAE,KAAK,OAAO,QAAQ,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI,GAAG,MAAM,EAAE,IAAI;AAAA,UACrE;AAAA,QACJ,OAAO;AACH,kBAAQ,MAAM,mBAAmB,MAAM,KAAK,IAAI,MAAM,EAAE;AAAA,QAC5D;AAAA,MACJ,SAAS,GAAG;AACR,gBAAQ,MAAM,oBAAoB,MAAM,IAAI,CAAC;AAAA,MACjD;AAAA,IACJ;AAAA,EACJ;AACJ;",
  "names": []
}
